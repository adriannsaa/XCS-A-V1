apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'eclipse'
apply plugin: 'maven-publish'
apply plugin: 'com.bmuschko.cargo'

ext.libraryVersions = [
        javaee                  : '7.0',
        wildfly                 : '1.1.0.Alpha1',
        junit                   : '4.12',
        arquillian              : '1.1.10.Final',
        shrinkWrapResolverGradle: '2.2.0'
]

group = 'ansaaXCS'
version = '1.0-SNAPSHOT'

sourceCompatibility = 1.7

repositories {
  mavenCentral()
  maven { url 'http://repository.jboss.org/nexus/content/groups/public' }
  maven { url 'http://repository.jboss.org/nexus/content/repositories/deprecated' }
  maven { url 'http://repo.jfrog.org/artifactory/repo' }
}


dependencies {
    compile group: 'commons-collections', name: 'commons-collections', version: '3.2'
    testCompile group: 'junit', name: 'junit', version: '4.+'
    testCompile group: 'org.hamcrest', name: 'hamcrest-library', version: '1.3'
    testCompile group: 'org.mockito', name: 'mockito-core', version: '1.9.5'

    providedCompile "javax:javaee-api:${libraryVersions.javaee}"
    testCompile "junit:junit:${libraryVersions.junit}"
    testCompile "org.jboss.arquillian.junit:arquillian-junit-container:${libraryVersions.arquillian}"
    testCompile "org.jboss.arquillian.protocol:arquillian-protocol-servlet:${libraryVersions.arquillian}"
    testCompile "org.wildfly.arquillian:wildfly-arquillian-container-managed:${libraryVersions.wildfly}"
    testCompile "org.jboss.shrinkwrap.resolver:shrinkwrap-resolver-gradle-depchain:${libraryVersions.shrinkWrapResolverGradle}"

    def cargoVersion = '1.4.5'
    cargo "org.codehaus.cargo:cargo-core-uberjar:$cargoVersion",
      "org.codehaus.cargo:cargo-ant:$cargoVersion"
}

jar {
    manifest {
        attributes 'Implementation-Title': 'XCS', 'Implementation-Version': version
    }
}


publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}
publishing {
    repositories {
        maven {
        credentials {
                   username 'admin'
                   password 'admin123'
               }
               url "http://localhost:8081/repository/XCS-SNAPSHOTS/"
        }
    }
}

buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
        maven {
            url 'https://dl.bintray.com/nikit007/mvn-repo/'
        }
        jcenter()
    }
    dependencies {
        classpath "com.github.nikit.cpp.helpers:db:1.0.7"
        classpath "gradle.plugin.com.github.nikit.cpp:wildflyDeployPlugin:1.0.8"
        classpath 'com.bmuschko:gradle-cargo-plugin:2.2.3'
    }
}
apply plugin: "com.github.nikit.cpp.wildfly.deploy"

deployConfig {
    deployFile = "scripts/deploy" // list of files to deploy
      jbossHome = "/home/ansaa/Desktop/Facultad/Programas/wildfly-8.2.1.Final"
    boxes = [
        'Local' : [
            wildfly:new helpers.Server()
        ]
    ]
}


test {
    testLogging {
        events 'passed', 'skipped', 'failed'
        exceptionFormat = 'full'
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '3.3'
}

cargo {
    containerId = 'wildfly8x'
    port = 8080

    deployable {
        context = '/'
    }

    remote {
        hostname = ''
        username = ''
        password = ''
    }

    local {
        homeDir = file('/home/ansaa/Desktop/Facultad/Programas/wildfly-8.2.1.Final')
        outputFile = file('build/output.log')
        timeout = 60000

    }
}

